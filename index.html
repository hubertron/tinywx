<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tiny Weather | Get the current forecast at your location in low bandwidth situations</title>
  <style>
    body {
      font-size: 16px;
    }
    h1 {
      margin: 0;
    }
    h2 {
      font-size: 20px;
      margin: 0 0 10px 0;
      font-weight: normal;
    }

    #name {
      clear: both;
      font-weight: bold;
      padding-top: 20px;
    }

    #hourlyBlock {
      margin: 20 auto;
    }

    table {
      border-collapse: collapse;
    }

    td,
    th {
      padding: 5px;
    }

  </style>
</head>

<body>
  <h1>Tiny Weather</h1><h2>Low bandwidth weather from NOAA for when you just have one bar of service.</h2>
  <a href="#">About</a> this project

  <p id="status"></p>
  <div id="forecast"></div>
  <div id="hourlyBlock">
    <div id="hourly"></div>
  </div>
  <br><br>
  <table border="1" id="currentTable">
    <tr>
      <th>Hour</th>
      <th>Temp</th>
      <th>Wind</th>
      <th>Skies</th>
    </tr>

  </table>

  <script>
    const status = document.querySelector('#status');
    const forecast = document.querySelector('#forecast');
    const hourly = document.querySelector('#hourly');
    const table = document.querySelector('#currentTable');

    function printScreen(data) {
      var i;
      for (i = 0; i < 3; i++) {
        forecast.innerHTML += `<div id="name">${data.periods[i].name}</div>`;
        forecast.innerHTML += `<div id="mainForecast">${data.periods[i].detailedForecast}</div>`;
      };
    };

    function printHourly(data) {
      var i;

      for (i = 0; i < 12; i++) {
        table.innerHTML += `<tr><td>${i + 1}</td><td>${data.periods[i].temperature} °${data.periods[i].temperatureUnit}</td><td>${data.periods[i].windDirection} ${data.periods[i].windSpeed}</td><td>${data.periods[i].shortForecast}</td></tr>`

      };
    };

    function geoFindMe() {
      forecast.textContent = '';

      function success(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        status.textContent = '';

        fetch(`https://api.weather.gov/points/${latitude},${longitude}`)
          .then(response => response.json())
          .then(data => fetch(data.properties.forecast))
          .then(response => response.json())
          .then(data => printScreen(data.properties))

        fetch(`https://api.weather.gov/points/${latitude},${longitude}`)
          .then(response => response.json())
          .then(data => fetch(data.properties.forecastHourly))
          .then(response => response.json())
          .then(data => printHourly(data.properties));
      }

      function error() {
        status.textContent = 'Unable to retrieve your location, you must have location services turned on in order go quickly access weather information. We do not store your location whatsoever.';
      }

      if (!navigator.geolocation) {
        status.textContent = 'Geolocation is not supported by your browser, unfortuantly you wil not be able to use this website.';
      } else {
        status.textContent = 'Locating…';
        navigator.geolocation.getCurrentPosition(success, error);
      }

    }

    geoFindMe();
  </script>
</body>

</html>